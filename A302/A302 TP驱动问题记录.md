### A302 TP驱动问题记录 ###

#### 一、问题描述 ####

- A302的gt9xx的驱动程序是从老程序移植的，版本2.0；
- 移植完成后修改了GROUP数组，第一版厚TP可以使用；
- 从第二版开始，TP变得时好时坏，但是第一版TP一直可以用；
- 经过TP厂家测试，同样的TP插在别的厂家的机器上是好用的；
- 经过IC厂家确认，三版TP的IC无任何差别；

#### 二、问题分析 ####

1. 接口板电路问题。第一版TP可以用，但是第二三版时好时坏，首先怀疑是TP的问题，经过TP厂家确认，TP无任何问题，同一块TP接到别的厂家的机器上是好用的，排除TP的问题；换一台A302重试，问题依然存在，排除机器的问题。

2. 驱动问题。由于第一版TP可用，所以一直找不到驱动的问题，使用示波器测试中断信号，在第一版TP中触摸屏幕，可以正常产生中断信号，但是不可用的TP没有任何信号。

#### 三、解决方案 ####

##### 1.源码分析

​	在修改源码的过程中一直在修改配置宏，没有查看硬件接口相关的配置，查看硬件IO宏配置，发现TP的INT复位有两个宏配置，其中GPIO1_PB7被注释掉，当前在用的是GPIO0_PB5，对照原理图发现TP的INT引脚接的是GPIO1_PB7引脚。

##### 2.解决方案

​	造成后两版TP不可用的原因是INT引脚配置错误导致的，驱动中的INT引脚配置为GPIO1_PB7后解决问题。

##### 3.驱动完善

​	TP调试完成后HOME键按下无反应，在adb shell中使用`getevent`查看TP上报的HOME键键值是0x66（102 D），查看/system/usr/keylayout/General.kl文件，发现HOME键对应的键值为0xAC（172D），在kernel中修改include/linux 下的input.h文件，将HOME的上报键值改为172，解决问题。